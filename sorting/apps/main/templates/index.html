{% extends "subsite.html" %}
{% load i18n %}


{# This is the page title #}
{% block title %}{{ block.super }} - SORTING{% endblock %}


{# Content of the page #}
{% block inner_markup %}
					<div class="title">Benvenuti su spr-sorting</div>
					<div class="row top-buffer text-center">
						<div class="col-xs-4">
							<p>OFFSET VENTOSE</p>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-2">
							<button type="button" class="btn btn-default btn-lg" id="btnDecOffsetX" name="btnDecOffsetX" onclick="decOffsetX();">
								<span class="glyphicon glyphicon-chevron-left"></span>
							</button>
							X
							<button type="button" class="btn btn-default btn-lg" id="btnIncOffsetX" name="btnIncOffsetX" onclick="incOffsetX();">
								<span class="glyphicon glyphicon-chevron-right"></span>
							</button>
						</div>
						<div class="col-xs-2 text-center">
							<button type="button" class="btn btn-default btn-xs" style="width: 100px; margin-bottom: 6px;" id="btnRicalcola" name="btnRicalcola" onclick="checkIntersection();">
								RICALCOLA
							</button>
							<button type="button" class="btn btn-default btn-xs" style="width: 100px" id="btnRicalcola" name="btnRicalcola" onclick="alert('ToDo!');">
								ACCETTA
							</button>
						</div>
						<div class="col-xs-2 text-right">
							<button type="button" class="btn btn-default btn-lg" id="btnDecOffsetY" name="btnDecOffsetY" onclick="decOffsetY();">
								<span class="glyphicon glyphicon-chevron-up"></span>
							</button>
							Y
							<button type="button" class="btn btn-default btn-lg" id="btnIncOffsetY" name="btnIncOffsetY" onclick="incOffsetY();">
								<span class="glyphicon glyphicon-chevron-down"></span>
							</button>
						</div>
						<div class="col-xs-2">
							<label class="checkbox">  
                			<input type="checkbox" onclick="if (this.checked) leftWing=-300; else leftWing=0; refreshCircles();">  
                			Appendice SX
                			</label>
                		</div>
						<div class="col-xs-2">
							<label class="checkbox">  
                			<input type="checkbox" onclick="if (this.checked) rightWing=300; else rightWing=0; refreshCircles();">  
                			Appendice DX
                			</label>
                		</div>
					</div>
					<div class="row top-buffer">
						<div class="col-xs-12">
							<p>PRIMA MISSIONE</p>
							<div id="cmbR" style="width:100%;height:300px"></div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12">
							<p>SECONDA MISSIONE...</p>
						</div>
					</div>
{% endblock %}
{# end of content #}

{% block js %}
{{ block.super }}
		<script type="text/javascript" src="{{ STATIC_URL }}js/cmbRaphael.js"></script>
		<script type="text/javascript" src="{{ MEDIA_URL }}{{ drawSheet }}"></script>
		<script type="text/javascript">
			// var paper = Raphael("placeholder", "100%", "100%");
			var paper = cmbR;
			var minOffsetX = 0; var minOffsetY = 0;
			var maxOffsetX = 400; var maxOffsetY = 300;
			var offsetX = 20; var offsetY = 15;
			// var icons = {{ icons|safe }};
			var icons = [];
			var circles = new Array();
			var circleRadius = 30;
			var leftWing = 0; var rightWing = 0;
			function decOffsetX(valore) {
				offsetX = offsetX>minOffsetX ? offsetX-10 : minOffsetX;
				$('#btnDecOffsetX').prop('disabled', offsetX==minOffsetX);
				$('#btnIncOffsetX').prop('disabled', false);
				refreshCircles();
			}
			function incOffsetX(valore) {
				offsetX = offsetX<maxOffsetX ? offsetX+10 : maxOffsetX;
				$('#btnIncOffsetX').prop('disabled', offsetX==maxOffsetX);
				$('#btnDecOffsetX').prop('disabled', false);
				refreshCircles();
			}
			function decOffsetY(valore) {
				offsetY = offsetY>minOffsetY ? offsetY-10 : minOffsetY;
				$('#btnDecOffsetY').prop('disabled', offsetY==minOffsetY);
				$('#btnIncOffsetY').prop('disabled', false);
				refreshCircles();
			}
			function incOffsetY(valore) {
				offsetY = offsetY<maxOffsetY ? offsetY+10 : maxOffsetY;
				$('#btnIncOffsetY').prop('disabled', offsetY==maxOffsetY);
				$('#btnDecOffsetY').prop('disabled', false);
				refreshCircles();
			}
			function drawCircle(posX, posY) {
				var x = posX + offsetX;
				var y = posY + offsetY;
				var r = circleRadius;
				var circle = paper.circle(x, y, r);
				circle.attr("fill", "#fcc");
				circle.attr("stroke", "#fff");
				/* var attr = {
						fill: "#F00",
						stroke: "#666",
						"stroke-width": 1,
						"stroke-linejoin": "round"
				};
				var path = "M"+(x)+","+(y-r)+"A"+r+","+r+",0,1,1,"+(x-0.1)+","+(y-r)+"z";
				paper.path(path).attr(attr); */
				circles.push(circle);
			}
			function drawCircles() {
				/* for (var i=0; i<10; i++) {
					for (var j=0; j<8; j++) {
						drawCircle(i*30, j*30);
					}
				} */
				// linea 1
				drawCircle(600+leftWing, 0);
				drawCircle(830+leftWing, 0);
				drawCircle(1050+leftWing, 0);
				drawCircle(1270+leftWing, 0);
				drawCircle(1670+rightWing, 0);
				drawCircle(1890+rightWing, 0);
				drawCircle(2110+rightWing, 0);
				drawCircle(2340+rightWing, 0);
				// linea 2
				drawCircle(600+leftWing, 130);
				drawCircle(830+leftWing, 130);
				drawCircle(1050+leftWing, 130);
				drawCircle(1270+leftWing, 130);
				drawCircle(1670+rightWing, 130);
				drawCircle(1890+rightWing, 130);
				drawCircle(2110+rightWing, 130);
				drawCircle(2340+rightWing, 130);
				// linea 3
				drawCircle(740+leftWing, 270);
				drawCircle(2200+rightWing, 270);
				// linea 4
				drawCircle(600+leftWing, 390);
				drawCircle(830+leftWing, 390);
				drawCircle(1050+leftWing, 390);
				drawCircle(1270+leftWing, 390);
				drawCircle(1670+rightWing, 390);
				drawCircle(1890+rightWing, 390);
				drawCircle(2110+rightWing, 390);
				drawCircle(2340+rightWing, 390);
				// linea 5
				drawCircle(600+leftWing, 590);
				drawCircle(830+leftWing, 590);
				drawCircle(1050+leftWing, 590);
				drawCircle(1270+leftWing, 590);
				drawCircle(1670+rightWing, 590);
				drawCircle(1890+rightWing, 590);
				drawCircle(2110+rightWing, 590);
				drawCircle(2340+rightWing, 590);
				// linea 6
				drawCircle(740+leftWing, 710);
				drawCircle(2200+rightWing, 710);
				// linea 7
				drawCircle(600+leftWing, 850);
				drawCircle(830+leftWing, 850);
				drawCircle(1050+leftWing, 850);
				drawCircle(1270+leftWing, 850);
				drawCircle(1670+rightWing, 850);
				drawCircle(1890+rightWing, 850);
				drawCircle(2110+rightWing, 850);
				drawCircle(2340+rightWing, 850);
				// linea 8
				drawCircle(600+leftWing, 980);
				drawCircle(830+leftWing, 980);
				drawCircle(1050+leftWing, 980);
				drawCircle(1270+leftWing, 980);
				drawCircle(1670+rightWing, 980);
				drawCircle(1890+rightWing, 980);
				drawCircle(2110+rightWing, 980);
				drawCircle(2340+rightWing, 980);
			}
			function drawIcons() {
				var attr = {
						fill: "#333",
						stroke: "#666",
						"stroke-width": 1,
						"stroke-linejoin": "round"
				};
				for (var i=0; i<icons.length; i++) {
					paper.path(icons[i]).attr(attr);
				}
			}
			/* function checkIntersection() {
				for (var i=0; i<icons.length; i++) {
					for (var j=0; j<circles.length; j++) {
						// var dotsOfIntersection = Raphael.pathIntersection(icons[i], circles[j]);
						// if (dotsOfIntersection.length > 0) {
						// 	paper.path(circles[j]).attr("fill", "#00F");
						// }
						var x = circles[j].attr('cx');
						var y = circles[j].attr('cy');
						if (Raphael.isPointInsidePath(icons[i], x, y)) {
							var radius = circles[j].attr('r');
							if (Raphael.isPointInsidePath(icons[i], x + radius, y)) {
								if (Raphael.isPointInsidePath(icons[i], x - radius, y)) {
									if (Raphael.isPointInsidePath(icons[i], x, y + radius)) {
										if (Raphael.isPointInsidePath(icons[i], x, y - radius)) {
											circles[j].animate({fill:'blue'},200);
										}
									}
								}
							}
						}
					}
				}
			} */
			function checkIntersection() {
				for (var j=0; j<circles.length; j++) {
					var x = circles[j].attr('cx');
					var y = circles[j].attr('cy');
					var icon = iconUnderPoint(x, y, circleRadius*2, circleRadius*2);
					var myColor = "#000";
					if (icon['icon'] == "") {
						myColor = "#909090";
					} else {
						if (icon['isNotUnload'])
						{
							myColor = "#FFFF00";
						} 
						else if (icon['isPicked'])
						{
							myColor = "#FF8000";
						}
						else if (icon['isInsideExternal'] && !icon['isInsideInternal'])
						{
							myColor = "#00FF00";
						}
						else
						{
							myColor = "#FF0000";				
						}
					}
					circles[j].animate({fill:myColor},200);
				}
			}
			function refreshCircles() {
				for (var j=0; j<circles.length; j++) {
					circles[j].remove();
				}
				circles.length = 0;
				drawCircles();
			}
			function refresh() {
				paper.clear();
				// drawIcons();
				drawSheet();
				drawCircles();
				checkIntersection();
			}
			function readyFn( jQuery ) {
				$('body').css('background-color', '#E6E6E6');
				//$.plot($("#placeholder"), [ [[0, 0], [5000, 3500]] ], { yaxis: { max: 4000 } });
				refresh();
			}
			$(document).ready(readyFn);
		</script>
{% endblock %}
